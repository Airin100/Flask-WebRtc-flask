<!DOCTYPE html>
<html>
<head>
  <title>Live Broadcast</title>
  <style>
    body { text-align: center; background: #111; color: white; }
    video { width: 45%; margin: 10px; border: 2px solid #ccc; border-radius: 10px; }
  </style>
</head>
<body>
  <h1>ðŸ”´ Live Broadcast</h1>
  <video id="localVideo" autoplay playsinline muted></video>
  <video id="remoteVideo" autoplay playsinline></video>
  
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <script>
    const socket = io();

    const pc = new RTCPeerConnection();
    const localVideo = document.getElementById('localVideo');
    const remoteVideo = document.getElementById('remoteVideo');

    // à¦²à§‹à¦•à¦¾à¦² à¦•à§à¦¯à¦¾à¦®à§‡à¦°à¦¾ à¦¸à§à¦Ÿà§à¦°à¦¿à¦®
    navigator.mediaDevices.getUserMedia({ video: true, audio: true })
      .then(stream => {
        localVideo.srcObject = stream;
        stream.getTracks().forEach(track => pc.addTrack(track, stream));
      });

    // à¦°à¦¿à¦®à§‹à¦Ÿ à¦¸à§à¦Ÿà§à¦°à¦¿à¦®
    pc.ontrack = event => {
      remoteVideo.srcObject = event.streams[0];
    };

    // ICE Candidate à¦¹à§à¦¯à¦¾à¦¨à§à¦¡à§‡à¦²à¦¿à¦‚
    pc.onicecandidate = event => {
      if (event.candidate) {
        socket.emit('signal', { 'candidate': event.candidate });
      }
    };

    // à¦¸à¦¿à¦—à¦¨à§à¦¯à¦¾à¦² à¦°à¦¿à¦¸à¦¿à¦­
    socket.on('signal', async message => {
      if (message.sdp) {
        await pc.setRemoteDescription(message.sdp);
        if (message.sdp.type === 'offer') {
          const answer = await pc.createAnswer();
          await pc.setLocalDescription(answer);
          socket.emit('signal', { 'sdp': pc.localDescription });
        }
      } else if (message.candidate) {
        await pc.addIceCandidate(message.candidate);
      }
    });

    // à¦¨à¦¿à¦œà§‡ à¦¥à§‡à¦•à§‡ Offer à¦¤à§ˆà¦°à¦¿
    async function makeCall() {
      const offer = await pc.createOffer();
      await pc.setLocalDescription(offer);
      socket.emit('signal', { 'sdp': pc.localDescription });
    }

    makeCall();
  </script>
</body>
</html>
